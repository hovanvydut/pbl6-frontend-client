<div class="flex justify-between items-center mb-10 sticky top-0">
  <b class="text-20">
    Thống kê
  </b>

  <div class="flex gap-10">
    <mat-form-field appearance="outline" class="example-form-field">
      <mat-label>Chọn thời gian</mat-label>
      <mat-date-range-input [formGroup]="range" [rangePicker]="rangePicker">
        <input matStartDate formControlName="start" placeholder="Start date" />
        <input matEndDate formControlName="end" placeholder="End date" />
      </mat-date-range-input>
      <mat-datepicker-toggle
        matSuffix
        [for]="rangePicker"
      ></mat-datepicker-toggle>
      <mat-date-range-picker #rangePicker>
        <mat-date-range-picker-actions>
          <button
            mat-button
            matDateRangePickerCance
            (click)="onDateRangeReset()"
          >
            Đặt lại
          </button>
          <button
            mat-raised-button
            color="primary"
            matDateRangePickerApply
            (click)="onDateRangeChanged()"
          >
            Apply
          </button>
        </mat-date-range-picker-actions>
      </mat-date-range-picker>
    </mat-form-field>
    <mat-form-field appearance="outline">
      <mat-select
        disableRipple
        [(value)]="this.statisticParams.key"
        (selectionChange)="onTabChanged()"
      >
        <mat-option *ngFor="let item of StatisticTypes" [value]="item.key">{{
          item.name
        }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>

<ng-container *ngIf="!isLoading && value && label">
  <div class="flex gap-10">
    <div
      class="chart-container bg-white px-15 py-20 rounded-12 shadow-md w-1/2"
    >
      <b class="text-16">
        Thống kê chung
      </b>
      <app-bar-chart
        [value]="value"
        [label]="label"
        [yaxisName]="selectedType.yaxis"
        [title]="selectedType.name"
        (chartClick)="chartClick($event)"
      ></app-bar-chart>
    </div>
    <div
      class="chart-container bg-white px-15 py-20 rounded-12 shadow-md w-1/2"
    >
      <div class="flex gap-10 items-start justify-between">
        <b class="text-16">
          Thống kê chi tiết <i> {{ detailTitle | date: "shortDate" }} </i>
        </b>
        <mat-form-field appearance="outline" *ngIf="isViewDetail">
          <input
            type="text"
            matInput
            placeholder="Tìm kiếm..."
            name="searchValue"
            (change)="getStatisticDetail()"
            [(ngModel)]="statisticDetailParams.searchValue"
          />
          <button matSuffix mat-button>
            <mat-icon>search</mat-icon>
          </button>
        </mat-form-field>
      </div>
      <div class="statistic-detail-container">
        <p *ngIf="!isViewDetail" class="pt-30 text-center">
          Click on the bar chart to view details
        </p>
        <mat-tab-group
          *ngIf="isViewDetail"
          (selectedTabChange)="cdr.detectChanges()"
        >
          <mat-tab label="Bảng số liệu">
            <div class="px-10 py-30">
              <div
                *ngIf="totalRecords > 0"
                class="table-wrapper rounded-12 shadow-md"
              >
                <table mat-table [dataSource]="statisticDetailData" matSort>
                  <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef>
                      Tên bài viết
                    </th>
                    <td mat-cell *matCellDef="let element" class="">
                      <p class="mx-15 line-clamp-2 pr-20 py-10">
                        {{ element.title }}
                      </p>
                    </td>
                  </ng-container>
                  <ng-container matColumnDef="value">
                    <th mat-header-cell *matHeaderCellDef>
                      Số lượt
                    </th>
                    <td mat-cell *matCellDef="let element">
                      <p class="mx-15 w-100">
                        {{ element.statisticValue }}
                      </p>
                    </td>
                  </ng-container>

                  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                  <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                  ></tr>
                </table>
              </div>
              <p *ngIf="totalRecords === 0" class="text-center">
                No data to show
              </p>
            </div>
          </mat-tab>
          <mat-tab label="Biểu đồ">
            <div class="flex justify-center h-full items-center">
              <app-pie-chart
                *ngIf="
                  detailValue?.length > 0 &&
                  detailLabel?.length > 0 &&
                  totalRecords > 0
                "
                [value]="detailValue"
                [label]="detailLabel"
              ></app-pie-chart>
              <p *ngIf="totalRecords === 0" class="pt-30 h-full text-center">
                No data to show
              </p>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>
  </div>
</ng-container>
